function json_check(e){if(!e)return"❌ JSON 데이터가 없습니다.";let t;try{t=JSON.parse(e)}catch(e){return"❌ JSON 파싱 실패: "+e.message}return"object"!=typeof t||null===t||Array.isArray(t)?"❌ JSON 데이터가 객체(Object)가 아닙니다.":t}function print(e){$("#load_message").text(e)}window.speechSynthesis,function(){let e,t={},a=[],n=new Set,o="";try{const e=new URLSearchParams(window.location.search);o=e.get("id")}catch(e){o=""}function r(e){print("✅ 플레이어 준비 완료.");const n=json_check(window.sessionStorage.getItem("json_data"));if("string"==typeof n)return alert(n),void print(n);t=n,a=Object.keys(t)}function s(t){0!==a.length?t.data===YT.PlayerState.PLAYING?e=setInterval(l,100):t.data!==YT.PlayerState.PAUSED&&t.data!==YT.PlayerState.ENDED||(clearInterval(e),e=null):t.data===YT.PlayerState.PLAYING&&(alert("화면해설 JSON 데이터가 로드되지 않았습니다."),print("❌ 오류 발생: JSON 데이터가 로드되지 않았습니다."),window.YTPlayer.pauseVideo())}function i(e){let t="유효하지 않은 YouTube 영상 ID입니다.";switch(e.data){case 2:t="잘못된 영상 ID 형식입니다.";break;case 5:t="HTML5 플레이어에서 오류가 발생했습니다.";break;case 100:t="영상이 존재하지 않거나 비공개입니다.";break;case 101:case 150:t="영상 소유자가 임베드를 허용하지 않습니다.";break}alert(t)}function l(){const a=window.YTPlayer.getCurrentTime();let o=parseInt($("#mode").val());isNaN(o)&&(o=0);for(const e of n)e>a&&n.delete(e);for(const r in t){const s=c(r);if(!n.has(s)&&(a>=s&&a<s+.5)){const a=t[r];clearInterval(e),0==o&&window.YTPlayer.pauseVideo(),2==o?$("#subtitle").text(a):d(a),n.add(s);break}}}function c(e){if(!e)return 0;let t=0;const a=e.split(":").reverse();for(const e in a){t+=parseFloat(a[e])*60**e}return t}function d(e){const t=parseFloat($("#tts_volume").val());isNaN(t)&&(t=.8);const a=parseFloat($("#tts_speed").val());isNaN(a)&&(a=1);let n=null;const o="ko-KR",r=window.speechSynthesis.getVoices().filter((e=>"ko-KR"==e.lang&&e.name.toLocaleLowerCase().includes("google"))),s=r.filter((e=>e.lang==o&&0==e.localService));if(0==s.length){const e=r.filter((e=>e.lang==o&&1==e.localService));if(0==e.length)return void print("❌ 지원하는 한국어 TTS가 없습니다.");n=e[0]}else n=s[0];const i=new SpeechSynthesisUtterance(e);i.lang=o,i.voice=n,i.rate=a,i.volume=t,i.onend=()=>{window.YTPlayer.getPlayerState()==YT.PlayerState.PAUSED&&window.YTPlayer.playVideo()},window.speechSynthesis.speak(i)}window.onYouTubeIframeAPIReady=function(){if(window.YTPlayer)return;try{window.YTPlayer=new YT.Player("player",{height:"315",width:"560",videoId:o,playerVars:{controls:1,modestbranding:1,showinfo:0,rel:0},events:{onReady:r,onStateChange:s,onError:i}})}catch(e){alert("잘못된 YouTube 영상 ID입니다.")}},window.YT&&window.YT.Player&&window.onYouTubeIframeAPIReady(),$("#mode").change((function(){const e=$(this).val(),t=$("#tts_volume, #tts_speed");2==e?t.attr("disabled",!0):t.attr("disabled",!1)}))}();